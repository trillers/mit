<activity-detail>
    <div class="view" if="{!hidden}" id="detail_document">
        <mask-loading show="{mask}"/>
        <div class="view" if="{!mask}">
                <div if="{debug}">
                    <a href="#activity/index">返回</a>
                    <a onclick={refresh} href="">刷新</a>
                    <a href="#debug/index">调试</a>
                </div>
                <div class="activity-detail-banner">
                    <img src="{picshow}"/>
                    <div>
                        <p class="font-size_{status1 ? status1 : ''}">{statusName}</p>
                        <span><i>{num ? num :'0'}</i></span>人
                    </div>
                </div>
                <div class="activity-detail-title">
                    <div>
                        <div>{item.name.length > 28 ? item.name.substring(0, 28)+'...':item.name}</div>
                        <ul><li each="{name,i in item.tags.type || []}">{__app.enums.TypeTags.values[name]}</li></ul>
                    </div> 
                    <div onclick="{likeActivity}">
                        <img src="/{env=='production'?'public':'web'}/images/{isActivityLike ? 'x_1':'x_2'}.png" class="vertical"/>
                        <span class="likesum">{likes}</span>
                    </div>
                </div>
                <div class="activity-detail-basic-info">
                    <div>
                        <div><img src="/{env=='production'?'public':'web'}/images/1_04.png" /></div>
                        <div>
                            <p>活动时间</p>
                            <p>{timeString}</p>
                            <p>报名截止 {closingTimeString}</p>
                        </div>
                    </div>
                    <div>
                        <div><img src="/{env=='production'?'public':'web'}/images/1_05.png" /></div>
                        <div>
                            <p>活动地点</p>
                            <p>{item.place}</p>
                        </div>
                    </div>
                    <div>
                        <div><img src="/{env=='production'?'public':'web'}/images/1_06.png" /></div>
                        <div>
                            <p>发起人</p>
                            <p><img src="{initiatorHeadUrl}" width="32" class="imgradius vertical" /> <span id="initiatorNameinitiatorContacts"></span></p>
                        </div>
                    </div>
                    <p class=" immediately" if="{status1=='a'}">我要报名</p>
                </div>
                <div class="acrivity_Introduction_nav">
                    <div class="activity_title">
                        <span></span>
                        活动介绍
                    </div>
                </div>
                <div id="ac_detail" class="activity-detail-introduce">
                    <!--{showDesc(acDesc)}-->
                </div>
                <div class="activity-detail-nav" onclick="{operationNav}">
                    <!--<div class="{(currentIndex == 0) ? 'checked' : ''}" alt="0" id="introduce_div1">介绍</div>-->
                    <div class="{(currentIndex == 2) ? 'checked' : ''}" alt="2">队友</div>
                    <div class="{(currentIndex == 1) ? 'checked' : ''}" alt="1">咨询</div>
                    <div class="{(currentIndex == 3) ? 'checked' : ''}" alt="3" id="random_notes_div1">随记</div>
                </div>
                <div class="clear"></div>
                <div class="activity-detail-applications" id="applications" if="{currentIndex==2}">
                    <div if="{applicShow === true}" >
                        <div if="{isinitiator == false}">
                            <applications-item class="no_border"  each={applic} tag="{this}"  />
                        </div>
                        <div if="{isinitiator == true}">
                            <div if="{sms_send == 0}">
                                <applications-item-initiator class="no_border"  each={applic} tag="{this}"  />
                            </div>
                            <div if="{sms_send == 1}">
                                <form>
                                    <div class="check_all" onclick="{allSelect}"><p if="{selectbut == true}">全选</p><p if="{selectbut == false}">取消全选</p></div>
                                    <applications-item-initiator-sms class="no_border"   each={applic} tag="{this}"  />
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="no-content" if="{applicShow === false}">
                        没人报名，赶快去抢沙发吧~~~
                    </div>
                    <!--<div onclick="{applicantFetch}" if="{applicLoadMoreShow === true}">加载更多</div>-->
                </div>
                <div class="activity-detail-communication" if="{currentIndex==1}">
                    <div if="{cmtShow === true}">
                        <communication-index class="no_border" each={comments} tag="{this}"/>
                    </div>
                    <div class="no-content" if="{cmtShow === false}">
                        没有内容，你来发表第一条吧~~~
                    </div>
                </div>

                <div class="activity-detail-randomnotes" if="{currentIndex==3}">
                    <randomnotes-item class="no_border" each={randomNotes} tag="{this}" />
                    <div class="no-content" if="{randomNoteShow === false}">
                        空空如也，你也来晒晒图吧~~~
                    </div>
                </div>
                <div class="activity-detail-recommend-title">
                    <div>
                        <span></span>
                        相关推荐
                    </div>
                </div>
                <div>
                    <activity-recommend-item  each={items} curritem="{this}" />
                </div>
                <div class="clear"></div>
                <div class="two_dimension_botder-top"></div>
                <div class="two_dimension">
                    <img src="/{env=='production'?'public':'web'}/images/two_dimension.png" />
                </div>
                <div class="clear"></div>
                <div class="serv t-c" id="detail_serv">
                    <p>使用过程中如有任何疑问请咨询客服</p>
                    <p class="m_top10_media p2"><img src="/{env=='production'?'public':'web'}/images/1_19.png" /> 客服电话：400-680-9072</p>
                </div>
                <!--报名信息 -->
                <div class="apply_wary activity-detail-apply">
                    <img src="/web/images/bmwhole.png" class="applyclosebtn_img" />
                    <div id="applyclosebtn" onclick="{closeApplyLayer}" ></div>
                    <div>
                        <p if="{fieldIfExist('displayName')}"><span class="vertical set_line_height26">姓名:　</span><input type="text" class="userinfo" name="displayName" value="{contact.displayName}" id="displayName"  placeholder="" onclick="{preventEvent}"/></p>
                        <p if="{fieldIfExist('phone')}"><span class="vertical set_line_height26">手机:　</span><input type="tel" class="userinfo" name="phone" id="phone" placeholder="" value="{contact.phone}" onclick="{preventEvent}"/></p>
                        <div if="{fieldIfExist('gender')}">
                            <span class="vertical">性别: </span>
                            <div class="{(contact.gender && contact.gender == '1') ? 'sex right1 checked' : 'sex right1'}" onclick="{sexSelect}" value="1">女</div>
                            <div class="{(contact.gender && contact.gender == '1') ? 'sex right2' : 'sex right2 checked'}" onclick="{sexSelect}" value="0">男</div>
                            <input name="gender" type="hidden" id="gender" value="{contact.gender || 0}" />
                        </div>
                        <div class="date_of_birth" if="{fieldIfExist('birthday')}">
                            <span class="vertical">出生日期:</span>
                            <input type="text" id="birthdayTxt" value="" readonly="readonly" class="userinfo textw1" style="width:70%;"/>
                            <input id="birthday" onchange="{birthdayChange}" onclick="{birthdayClick}" onblur="{birthdayBlur}" name="birthday" style="display: inline-block;margin-top:0px;width:70%;" type="date"/>
                            <p>请选择 </p>
                        </div>
                        <p if="{fieldIfExist('IDCard')}"><span class="vertical set_line_height26">身份证:　</span><input type="text" class="userinfo" name="IDCard" id="IDCard" placeholder="" value="{contact.IDCard}" onclick="{preventEvent}" style="width:75%;"/></p>
                        <p if="{fieldIfExist('company')}"><span class="vertical set_line_height26">单位:　</span><input type="text" class="userinfo" name="company" id="company" placeholder="" value="{contact.company}" onclick="{preventEvent}"/></p>
                        <p if="{fieldIfExist('position')}"><span class="vertical set_line_height26">职位:　</span><input type="text" class="userinfo" name="position" id="position" placeholder="" value="{contact.position}" onclick="{preventEvent}"/></p>
                        <p if="{fieldIfExist('business')}"><span class="vertical set_line_height26">行业:　</span><input type="text" class="userinfo" name="business" id="business" placeholder="" value="{contact.business}" onclick="{preventEvent}"/></p>
                        <p if="{fieldIfExist('school')}"><span class="vertical set_line_height26">学校:　</span><input type="text" class="userinfo" name="school" id="school" placeholder="" value="{contact.school}" onclick="{preventEvent}"/></p>
                        <p if="{fieldIfExist('discipline')}"><span class="vertical set_line_height26">专业:　</span><input type="text" class="userinfo" name="discipline" id="discipline" placeholder="" value="{contact.discipline}" onclick="{preventEvent}"/></p>
                        <p if="{fieldIfExist('class')}"><span class="vertical set_line_height26">班级:　</span><input type="text" class="userinfo" name="class" id="class" placeholder="" value="{contact.class}" onclick="{preventEvent}"/></p>
                        <div class="number_of_people">
                            <span class="vertical">人数: </span>
                            <div  value="+" class="add" id="add1" >+</div> <input type="text" class="sum_info" value="1" name="num" id="num" readonly /><div value="-" class="minus" id="minus1" >-</div>
                        </div>
                        <input name="applicant" type="hidden" id="applicant" value="" class="userinfo"/>
                        <div class="message" if="{fieldIfExist('desc')}">
                            <table class="">
                                <tr>
                                    <td valign="top" width="35"><span >备注:　</span></td>
                                    <td valign="top"> <textarea name="desc" id="desc" placeholder="" class="textarea1" onclick="{preventEvent}" rows="2" ></textarea></td>
                                </tr>
                            </table>　
                        </div>
                        <p class="presentation">以上信息仅活动发起人可见，不会透露给其他人</p>
                        <div id="applyaddbtn" >提 交</div>
                    </div>
                    <div class="applysubbtn"></div>
                </div>
                <div class="body_shadow display_none"></div>
                <!--底部 -->
                <div class="footer_placeholder clear"></div>
                <div class="footer" name="btnbox">
                    <div onclick="{returnPage}"></div>
                    <div class="but1 star_undo button {isActivityStar ? 'star':''}" onclick="{activityStar}" if="{menu(status1,isinitiator,currentIndex,num).actions.star()}"></div>
                    <div class="recall_but1 button but1" if="{menu(status1,isinitiator,currentIndex,num).actions.recall()}">撤回</div>
                    <div class="button but1" onclick="{editpa}" if="{menu(status1,isinitiator,currentIndex,num).actions.modify()}">修改</div>
                    <!--短信群发-->
                    <div class="button but1_export" if="{menu(status1,isinitiator,currentIndex,num).actions.export() && sms_send == 0}" onclick="{showSendmail}">导出名单</div>
                    <div class="button but1" onclick="{cancelSend}" if="{menu(status1,isinitiator,currentIndex,num).actions.smsSend() && sms_send == 1}">取消</div>
                    <div class="button butmasstexting" if="{menu(status1,isinitiator,currentIndex,num).actions.massTexting() && sms_send == 0}" onclick="{addSend}">群发短信</div>
                    <a href="#"  onclick="javascript:var errorarr = []; errorarr.push('请选择要发送的队友');  util.tipssuccess(0, errorarr[errorarr.length-1], 1);return false;" class="send"  if="{menu(status1,isinitiator,currentIndex,num).actions.smsSend() && sms_send == 1}"><div class="button but2">发送</div></a>
                    <!--我要报名-->
                    <div class="immediately button but2 {(menu(status1,isinitiator,currentIndex,num).len==0) ? 'randomnote' : ''}  {(menu(status1,isinitiator,currentIndex,num).len==3) ? 'butmasstexting_width1' : ''} {(menu(status1,isinitiator,currentIndex,num).len==1) ? 'publish_width1' : ''}" if="{menu(status1,isinitiator,currentIndex,sms_send).actions.application()}">我要报名</div>
                    <!--立即发布-->
                    <div class="release_but1 button but2" if="{menu(status1,isinitiator,currentIndex,num).actions.modify()}">立即发布</div>
                    <!--添加随记-->
                    <div class="button randomnote" onclick="{addRandomNote}" if="{menu(status1,isinitiator,currentIndex,num).actions.randomNote()}">添加随记</div>
                    <!--发布活动-->
                    <div class="button publish {(menu(status1,isinitiator,currentIndex,num).len==2) ? 'publish_width1' : ''} {(menu(status1,isinitiator,currentIndex,num).len==3) ? 'publish_width1' : ''} {(menu(status1,isinitiator,currentIndex,num).len == 4) ? 'butmasstexting_width1' : ''}" onclick="{showattention_by_publish}" if="{menu(status1,isinitiator,currentIndex,num).actions.publish()}">发布活动</div>
                    <!--咨询-->
                    <div class="interflow_footer" if="{menu(status1,isinitiator,currentIndex,consult).actions.comment()}">
                        <input type="text" name="interflow_content" id="interflow_content" placeholder="说说你的想法..." onclick="{interruptedBubbling}" value="">
                        <span onclick="{addComment}">发送</span>
                    </div>
                    <div class="interflow_footer" if="{menu(status1,isinitiator,currentIndex,consult).actions.replyComments()}">
                        <input type="text" name="interflow_reply" id="interflow_reply" placeholder="" onclick="{interruptedBubbling}">
                        <span onclick="{replyComment}">发送</span>
                    </div>
                </div>
            </div>
            <div class="body_shadow_pull display_none" onclick="{hideBodyShadowAll_detail}"></div>
            <div class="wechat-concern display_none">
                <img src="/{env=='production'?'public':'web'}/images/closebtn2.png" class="closebtn2" onclick="{hideBodyShadowAll_detail}"/>
                <p class="t-c inde_font">关注“快乐种子”后，可以接收活动<br/>提醒和使用其他更多服务！</p>
                <div if="{!fromButtonClick}">
                    <div class="but_left fl t-c" onclick="{openWxhref}">关注，支持一下</div>
                    <div class="but_right fl t-c" onclick="{hideBodyShadowAll_detail}">残忍拒绝:(</div>
                </div>
                <button class="atten_but border_radius" onclick="{openWxhref}" if="{fromButtonClick}">立即关注</button>
            </div>
            <div class="together display_none together_detail" id="clickXHidden" onclick="{hideBodyShadowAll_detail}">
                <img src="/public/images/shareInfo1.png" class="together_img"/>
            </div>
            <div class="sendmail">
                <input type="email" name="mailboxName" value="{contact.email}" id="mailboxName" placeholder="请输入您的邮箱">
                <div onclick="{exportmail}">发送到邮箱</div>
                <div onclick="{hideBodyShadowAll_detail}">取消</div>
            </div>
        </div>
    <style scoped>
        :scope{

        }
        input{
            background:transparent;
        }
        .typetagsul{

        }
        .typetagsul li{
            float: left;line-height:18px;
        }
        .imgPreviewer ul li{
            float:left;
        }
    </style>
    <script>
        var spa = this.app = this.opts.app; //keep spa object
        var self = nest.presentable(this);
        //define activities
        var sendMailActivities = domain.action('sendMailActivities');
        var applyActivity = domain.action('applyActivity');
        var modifyStatusActivities = domain.action('modifyStatusActivities');
        var loadContact = domain.action('loadContact');
        var replyActivity = domain.action('replyActivity');
        var applicantLoadMore = domain.action('applicantLoadMore');
        self.env = __app.settings.env.NODE_ENV;
        self.debug = __app.settings.env.debug;
        self.menu = function(status, isinitior, currentIndex,num){
            var me = this, len = 0, status = util.events._valueToKey(__app.enums.ProductActivityStatus.names)[status],browsers =  __page.browser["Android"];
            me['actions'] = {
                publish: function(){ //发布
                    return ((status === 'Ready' || status === 'Completed' || status== 'Acting' || status === 'Reviewing')  || (status=="Draft" || status=="Cancelled" && !isinitior)) && (currentIndex == 0 || currentIndex == 2) ;
                },
                randomNote: function(){ //随记
                    return (currentIndex == 3);
                },
                comment: function(){ //评论
                    return (currentIndex == 1) && num ==0;
                },
                replyComments: function(){ //回复评论
                    return (currentIndex == 1) && num ==1;
                },
                modify: function(){ //修改
                    return (status=="Draft" || status=="Cancelled") && isinitior && (currentIndex == 0 || currentIndex == 2);
                },
                recall: function(){ //回撤
                    return  status=="Applying" && isinitior && (num==0) && (currentIndex == 0  || (currentIndex == 2));
                },
                application: function(){ //报名
                    return status=="Applying" && (currentIndex == 0 || currentIndex == 2) && num == 0;
                },
                star: function(){ //收藏
                    return (status === 'Ready' || status === 'Completed' || status== 'Acting' || status=="Applying" )  && (!isinitior || num > 0)  && (currentIndex == 0  || ( currentIndex == 2  && !isinitior));
                },
                massTexting : function(){  //群发短信
                    return  status !="Draft" && browsers && isinitior && currentIndex == 2 && num > 0;
                },
                export : function(){  //导出
                    return  status !="Draft"  && isinitior && currentIndex == 2 && num > 0;
                },
                smsSend : function(){  //发送or取消
                    return  status !="Draft" && browsers && isinitior && currentIndex == 2 && num > 0;
                }
            }
            for(var prop in me['actions']){
                if(me['actions'][prop]()){
                    len++;
                }
            }
            return {len:len, actions:me['actions']};
        };
        var dName = "";
        if (__page.user.displayName==null){
            dName = "";
        }
        else if (__page.user.displayName=="匿名"){
            dName = "";
        }
        else{
            dName = __page.user.displayName;
        }
        self.contact = {displayName: dName};
        self.dName = dName;//apply dialog's default name
        self.subscribe = true;//(__page.user.wx_subscribe == 1) ? true : false;
        self.wxhref = util.getWxhref();
        self.fromButtonClick = false;
        var replyToName="1";
        var replyTo = '';
        //生成like---Activity
        var likeActivity = domain.action('likeActivity');
        var starActivity = domain.action('starActivity');
        var commentActivity = domain.action('commentActivity');
        var model = nest.modelable({}, {
            url: __app.settings.api.url + "/pa/"
        });
        /*related recommendation begin*/
        var params = {
            sort: {'priorityRank':-1, 'statusrank':1, 'startTime':1},
            page: {
                size: 5,
                no: 1
            },
            conditions: {
                status: {"$in":['a','re','ac', 'co']},
                reviewStatus:{"$in":['t', 'd']},
                'tags.type': {},
                privateFlag: false
            }
        };
        __page.tenant && (params.conditions.tenantId = __page.tenant);
        var recCol = this.collection = nest.collectable({}, {
            url: __app.settings.api.url + "/pa/find",
            filter: params
        });
        __page.tenant && (params.conditions.tenantId = __page.tenant);
        recCol.on("fetch", function(models){
            var len = models.length;
            var inArr = false;
            for(var i = 0; i < len; i++){
                if(models[i]._id == self._id){
                    models.splice(i,1);
                    inArr = true;
                    break;
                }
            }
            if(!inArr) models.pop();
            self.update({items: models})
        });
        /*related recommendation end*/
        self.footershow = true;
        model._id = this._id = this.opts._id;
        model.on('fetch', function(json, options){
            console.info('activity is fetched');
            self.item = json;
            self.num = getNum(json);
            self.highlightsArray = getFormattingInof(json.desc.split("\n"));
            //self.acDesc = util.replaceImgTemplate(json.desc);
            self.applic = formatApplic(json.applications);  //limit init count 10
            self.randomNotes = json.randomNotes ? json.randomNotes : '';
            self.cmt = json.comments;
            self.status1 = json.status;
            self.reviewStatus = json.reviewStatus;
            self.applicShow = self.applic.length ? true : false;
            self.applicLoadMoreShow = json.applications.length > 10 ? true : false;
            self.randomNoteShow = self.randomNotes.length ? true : false;
            self.cmtShow = self.cmt.length ? true : false;
            self.id = json._id;
            self._comments = json.comments;
            loadDisplayComments();
            self.userId = window.__page.user.id;
            self.replyTo = '';
            self.replyToName = '';
            self.initiator = json.initiator;
            self.picshow = util.calcImageUrl(self.item);
            self.startTime = util.dateFormat(new Date(json.startTime),"yyyy/MM/dd");
            self.startTime_Week = util.getDateWeek(new Date(json.startTime));
            self.endTime = util.dateFormat(new Date(json.endTime),"yyyy/MM/dd");
            self.endTime_Week = util.getDateWeek(new Date(json.endTime));
            self.closingTime = util.dateFormat(new Date(json.closingTime),"yyyy/MM/dd");
            self.closingTime_Week = util.getDateWeek(new Date(json.closingTime));
            self.timeString = (self.endTime==self.startTime) ? self.startTime+" "+self.startTime_Week : (self.startTime+" "+self.startTime_Week+" - "+self.endTime+" "+self.endTime_Week);
            self.closingTimeString = self.closingTime+" "+self.closingTime_Week;
            self.likes = json.meta.likes;
            self.stars = json.meta.stars;
            self.applicationFields = json.applicationFields;
            self.isinitiator = (self.userId==self.initiator) ? true : false;
            self.currentIndex = 2;
            self.consult = 0;
            self.sms_send = 0;
            self.isActivityLike = __page.user.meta.pa.likes[self.id];
            self.isActivityStar = __page.user.meta.pa.stars[self.id];
            self.statusName = self.reviewStatus=='r' ? __app.enums.ReviewStatus.values[self.reviewStatus] : __app.enums.ProductActivityStatus.values[self.status1];
            self.selectbut = true;
            self.initiatorNameinitiatorContact = self.item.initiatorName+" "+self.item.initiatorContact;
            self.initiatorHeadUrl = self.item.userforHeadUrl.headImgUrl ? self.item.userforHeadUrl.headImgUrl : "/public/images/head.png";
            self.update();
            self.trigger('ready', true);
            self.trigger('view-route-to');
            showDesc(util.replaceImgTemplate(json.desc));
            $("#initiatorNameinitiatorContacts").text(self.initiatorNameinitiatorContact);
            registerHomeBtn();
            registerNav();
            setWeixinInfo_detail();
            //分享随记来路
            if(self.shareflag === 'true') {
                shareBack();
            }
            //分享引流来路
            if(self.guest) {
                self.currentIndex = 3;
                self.update();
                if(self.guest != 'true'){
                    scanRandomNoteHandler();
                }
            }
            else{
                //scroll top
                $(window).scrollTop(0);
            }
            showattention_check();
            console.log('cookie ' + util.getCookie('applicants'));
            hideAll();
        });

        /*
         * applicant list load more
         */
        var applicantParams = {
            page: {
                size: 10,
                no: 1
            },
            finish : false
        };

        applicantFetch(e){
            if (applicantParams.finish == false)
                applicantLoadMore.execute(self.id, applicantParams);
        };

        var onApplicantLoadMore = function (data) {
            if (data.length >= applicantParams.page.size) {
                applicantParams.page.no++;
                applicantParams.finish = false;
            }else{
                applicantParams.finish = true;
            }
            self.update({applic: formatApplic(data)});
        }

        self.fieldIfExist = function(fieldName){
            var exist = false;
            for(var i = 0, len = self.applicationFields.length; i < len; i++){
                if(self.applicationFields[i].name == fieldName) {
                    exist = true;
                    break;
                }
            }
            return exist;
        }
        function scanRandomNoteHandler(){
//            var test = {
//                "pics": [
//                    {
//                        "url": "7u2kxz.com2.z0.glb.qiniucdn.com/IIB1431055527573",
//                        "mediaId": "AXxS5Qe3h7goHjW9AvLH1FOhzIlufVGS4fxT5W4vkW9_V6AITH3Ev_vLEbM6GhOD",
//                        "meta": "720|1280",
//                        "name": "IIB1431055527573"
//                    },
//                    {
//                        "url": "7u2kxz.com2.z0.glb.qiniucdn.com/IIB1431055527573",
//                        "mediaId": "AXxS5Qe3h7goHjW9AvLH1FOhzIlufVGS4fxT5W4vkW9_V6AITH3Ev_vLEbM6GhOD",
//                        "meta": "720|1280",
//                        "name": "IIB1431055527573"
//                    }
//                ],
//                "desc":'测试'
//            };
//            util.wedgt.imgPreviewer($("#wary"), test.pics, { msg: test.desc });
            var randomNote_id = self.guest, randomNote_doc = self.randomNotes, i, len, currentRandomNote;
            for(i = 0, len = randomNote_doc.length; i < len; i += 1){
                if(randomNote_doc[i]._id === randomNote_id){
                    currentRandomNote = randomNote_doc[i];
                    currentRandomNote && currentRandomNote.pics && (currentRandomNote.pics.length > 0) && util.wedgt.imgPreviewer($("#wary"), currentRandomNote.pics, { msg: currentRandomNote.desc });
                    break;
                }
            }
        }

        function shareBack(){
            if(!self.randomNotes[0]){
                return;
            }
            var randomNote = self.randomNotes[0];
            wx.ready(function(){
                var me = randomNote;
                var parent = self;
                var returnUrl, info, sharemsg, sharetimeline;
                //弹出分享窗口
                self.shareinfo_detail();
                //填充分享内容
                if(me && me.pics[0] && me.pics[0]){
                    var item = {};
                    item.images = [];
                    item.images[0]={
                        meta:me.pics[0].meta,
                        url:me.pics[0].url
                    };
                    returnUrl = 'http://' + util.sharepic(item);
                }else{
                    returnUrl = "/public/images/pabanner.png";
                }
                info = {
                    title: "我在参加\"" + parent.item.name + "\"活动,给小伙伴直播一下~~~~",
                    desc: me.desc || parent.item.name,
                    link: __page.holder().getBaseUrl()+"/index#activity/_" + parent._id + "?guest=" + randomNote._id,
                    imgUrl: returnUrl
                };

                sharemsg = Object.create(info);
                sharemsg.success = function(){_czc.push(['_trackEvent', util.getDc().PA.NAME + '(' + util.getDc().PA.ACTION.SHARE + ')', parent.item.name || '', util.convertToValue(parent.item.tags.type).join(',') || '', 0])};
                sharetimeline = Object.create(info);
                sharetimeline.success = function(){_czc.push(['_trackEvent', util.getDc().PA.NAME + '(' + util.getDc().PA.ACTION.SHARE + ')', parent.item.name || '', util.convertToValue(parent.item.tags.type).join(',') || '', 0])};

                //分享给朋友
                wx.onMenuShareAppMessage(sharemsg);
                //分享朋友圈
                wx.onMenuShareTimeline(sharetimeline);
            });
        }
        editpa(e){
            riot.route('activity/edit/_'+self.id);
        }

        exportmail(e){
            var _id = this._id;
            var mailboxName = $("#mailboxName").val().trim();
            var name = self.item.name;
            var filter=/^.+@.+\..{2,3}$/;
            if (!filter.test(mailboxName)){
                return util.tipssuccess(1, '邮箱格式错误', 1);
            }
            sendMailActivities.execute({id:_id, mailboxName:mailboxName, name:name});
        }
        var loadDisplayComments = function(){
            var len = self._comments.length;
            self.comments = [];

            for (var i=0; i<len; i++){
                if (self._comments[i].reviewStatus != 'r'){
                    self.comments.push(self._comments[i]);
                }
            }
        }


        var _open = function(options){
            this.trigger('ready', false);
            self.shareflag = options.share;
            self.guest = options.guest || null;
            this._id = options.id || this._id;
            model.set('_id', this._id);
            model.fetch({action: 'open'});
            recCol.fetch();
        }.bind(self);
        var _refresh = function(){
            this.trigger('ready', false);
            model.fetch(this._id, {action: 'refresh'});
        }.bind(self);

        var onLikeActivity = function(data){
            if(!self.isActivityLike){
                if(data > self.likes){
                    _czc.push(['_trackEvent', util.getDc().PA.NAME + '(' + util.getDc().PA.ACTION.COLLECT + ')', self.item.name || '', util.convertToValue(self.item.tags.type).join(',') || '', data.result]);
                    self.isActivityLike= true;
                    __page.user.meta.pa.likes[self.id] = new Date().getTime();
                }else{
                    self.isActivityLike= false;
                    delete __page.user.meta.pa.likes[self.id];
                }
                self.likes = data;
                //spa.trigger('model-changed', 'update', self.id, 'likes', self.likes);
                self.update();
            }

        }
        var onStarActivity = function(data){
            if(data >self.stars){
                _czc.push(['_trackEvent', util.getDc().PA.NAME + '(' + util.getDc().PA.ACTION['LIKES'] + ')', self.item.name || '', util.convertToValue(self.item.tags.type).join(',') || '', data]);
                self.isActivityStar = true;
                util.tipssuccess(0, "收藏成功!", 1);
                __page.user.meta.pa.stars[self.id] = new Date().getTime();
            }else{
                self.isActivityStar =false;
                delete __page.user.meta.pa.stars[self.id];
            }
            self.stars = data;
            self.update();
        }
        var onReplyActivity = function(data){
            $("#interflow_content").val("");
            $("#interflow_content").attr('placeholder',"说说你的想法...");
            self.comments = data;
            self.cmtShow = self.comments.length ? true : false;
            self.update();
        }

        var onCommentActivity = function(data){
            $("#interflow_content").val("");
            $("#interflow_content").attr('placeholder',"说说你的想法...");
            self.comments = data;
            self.cmtShow = self.comments.length ? true : false;
            self.update();
        }
        var onSendMailActivities = function(data){
            util.tipssuccess(0, "邮件已发送！", 1);
            mail_hideAll();
        }
        var onApplyActivity = function(data){
            _czc.push(['_trackEvent', util.getDc().PA.NAME + '(' + util.getDc().PA.ACTION.APPLICATE + ')', self.item.name || '', util.convertToValue(self.item.tags.type).join(',') || '', data.length]);
            util.tipssuccess(0, "报名成功", 1);
            self.applic = formatApplic(data);
            self.applicShow = self.applic.length ? true : false;
            var nums = 0;
            for(var i=0;i<self.applic.length;i++){
                nums = nums+self.applic[i].num;
            }
            self.num = nums;
            self.update();
            hideAll();
            cleanDialog();
        }
        var onDoneModifyStatusActivities = function(obj){
            var status = this.inputs[1];
            if(status=="recall"){
                util.tipssuccess(0, "撤回成功!", 1);
            }
            if (status=="recall") {
                model.fetch();
            }else{
                riot.route('activity/createsuccess/_'+self.id);
            }
        }
        var onFailModifyStatusActivities = function(obj){
            var status = this.inputs[1];
            var errorarr = [];
            if(status=="recall"){
                errorarr.push("撤回失败!");
            }else if(status=="publish"){
                errorarr.push("发布失败!");
            }
            util.tipssuccess(1, errorarr[errorarr.length - 1], 1);
            errorarr.pop();
        }
        this.on('mount', function(){
            console.info('tag activity is mounted');
            likeActivity.onDone(onLikeActivity);
            starActivity.onDone(onStarActivity);
            replyActivity.onDone(onReplyActivity);
            commentActivity.onDone(onCommentActivity);
            sendMailActivities.onDone(onSendMailActivities);
            applyActivity.onDone(onApplyActivity);
            applicantLoadMore.onDone(onApplicantLoadMore);
            modifyStatusActivities.onDone(onDoneModifyStatusActivities);
            modifyStatusActivities.onFail(onFailModifyStatusActivities);
        });
        this.on('unmount', function(){
            console.info('tag activity is mounted');
            likeActivity.offDone(onLikeActivity);
            starActivity.offDone(onStarActivity);
            replyActivity.offDone(onReplyActivity);
            commentActivity.offDone(onCommentActivity);
            sendMailActivities.offDone(onSendMailActivities);
            applyActivity.offDone(onApplyActivity);
            applicantLoadMore.offDone(onApplicantLoadMore);
            modifyStatusActivities.offDone(onDoneModifyStatusActivities);
            modifyStatusActivities.offFail(onFailModifyStatusActivities);
        });
        this.on('leave', function(){
            util.wedgt.imgPreviewer.refresh($("#wary"));
        });

        this.on('open', function(options){
            console.info('tag activity is opening');
            model && model.fetched() && setWeixinInfo_detail();
            _open(options);
        });

        this.on('leave', function(){
            self.mask = true;
            self.update();
        });

        this.on('reenter', function(){
            self.mask = false;
            self.update();
        });

        this.on('refresh', function(){
            console.info('tag activity is refreshing');
            _refresh();
        });

        this.on('show', function(cmd){
            if(cmd){
                __page.holder().setTitle(self.item.name);
            }
            $(window).scrollTop("0px");
        });

        refresh(e){
            _refresh();
        }

        var getNum = function(json){
            var sum=0;
            for(var s = 0;s< json.applications.length; s++){
                sum = sum + json.applications[s].num;
            }
            return sum;
        };
        var getFormattingInof = function(info){
            for(var i=0;i<info.length;i++){
                if(info[i]){
                    info[i] = info[i].replace(/ /g,"&nbsp;");
                }
            }
            return info;
        }

        var limitApplicCount = function (applic) {
            var length = applic.length > 10 ? 10 : applic.length;
            var newApplic = applic.slice(0, length);

            for (var i = 0, len = length; i < len; i++) {
                if (newApplic[i].birthday) {
                    newApplic[i].birthday = util.dateFormat(new Date(newApplic[i].birthday), 'yyyy/MM/dd');
                }
                if (newApplic[i].gender) {
                    newApplic[i].gender = newApplic[i].gender == "0" ? "男" : "女";
                }
            }
            return newApplic;
        }

        var formatApplic = function (applic) {
            for (var i = 0, len = applic.length; i < len; i++) {
                if (applic[i].birthday) {
                    applic[i].birthday = util.dateFormat(new Date(applic[i].birthday), 'yyyy/MM/dd');
                }
                if (applic[i].gender) {
                    applic[i].gender = applic[i].gender == "0" ? "男" : "女";
                }
            }
            return applic;
        }
        var registerHomeBtn = function(){
            $(".img_home").click(function(){
                $(".home_gy").removeClass("home_gy_set1");
                $(".home_gy").addClass("home_gy_set");
            });
            $(".home_close").click(function(){
                $(".home_gy").removeClass("home_gy_set");
                $(".home_gy").addClass("home_gy_set1");
            });
            //票务预订填写订单数量
            setFunClick(1);
            $(".recall_but1").off('click').on("click",function(){
                callBizAction("recall");
            });
            $(".release_but1").off('click').on("click",function(){
                callBizAction("publish");

            });
            $(".immediately").off('click').on("click",function(){
                self.fromButtonClick = true;
                self.update();
                if(self.subscribe){
                    loadContactFunc();
                    signUp();
                }else{
                    showattention_detail();
                }
            });

            $(".body_shadow").off('click').on("click",function(){
                //hideAll();
            });

            $("#applyaddbtn").off("click");
            $("#applyaddbtn").on("click",function(){
                addApplicant();
            });
//            setfooterShwo();
        };
        var setWeixinInfo_detail = function(){
            var imgurl = util.sharepic(self.item);
            wx.ready(function(){
                //分享给朋友
                wx.onMenuShareAppMessage({
                    title: self.item.name, // 分享标题
                    desc: util.htmlParser.parse(self.item.desc), // 分享描述
                    link: __page.holder().getBaseUrl()+"/#activity/_"+model._id, // 分享链接
                    imgUrl: imgurl, // 分享图标
                    type: '', // 分享类型,music、video或link，不填默认为link
                    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                    success: function () {
                        _czc.push(['_trackEvent', util.getDc().PA.NAME + '(' + util.getDc().PA.ACTION.SHARE + ')', self.item.name || '', util.convertToValue(self.item.tags.type).join(',') || '', 0]);
                    },
                    cancel: function () {
                        // 用户取消分享后执行的回调函数
                    }
                });
                //分享朋友圈
                wx.onMenuShareTimeline({
                    title: self.item.name, // 分享标题
                    link: __page.holder().getBaseUrl()+"/index#activity/_"+model._id, // 分享链接
                    imgUrl: imgurl, // 分享图标
                    success: function () {
                        _czc.push(['_trackEvent', util.getDc().PA.NAME + '(' + util.getDc().PA.ACTION.SHARE + ')', self.item.name || '', util.convertToValue(self.item.tags.type).join(',') || '', 1]);
                    },
                    cancel: function () {
                        // 用户取消分享后执行的回调函数
                    }
                });
            });
        }
        function setBodyHeight(){
            var setbodyHeight = $(window).height() > $("body").height() ? $(window).height():$("body").height()
            $("body").height(setbodyHeight);
        }
        function hintSucceed(obj){
            var wintop = $(window).scrollTop();
            obj.show().css("top",wintop+20+"px");
            obj.animate({opacity:'hide'},2000);
        }
        function hideAll(){
            $(".body_shadow").hide();
            $(".apply_wary").hide();
        }
        function cleanDialog(){
            $("#num").attr("value", 1);
            document.getElementById("desc") && (document.getElementById("desc").value = "");
        }

        function getApplicantInfo(){
            var info = {};
            var fieldArr = self.applicationFields;
            for(var i=0; i<fieldArr.length; i++){
                info[fieldArr[i].name] = document.getElementById(fieldArr[i].name).value;
            }
            info.applicant = self.userId;
            info.num = document.getElementById("num").value;
            return info;
        }
        function addApplicant() {
            var temp = getApplicantInfo();
            var errorarr = [];
            var validator = util.validator();
            var fieldArr = Object.keys(temp);
            for(var i=0; i<fieldArr.length; i++){
                switch(fieldArr[i]){
                    case "displayName":
                        if (validator.empty(temp.displayName)) {
                             errorarr.push("请输入姓名！");
                        }
                        break;
                    case "phone":
                        if (validator.empty(temp.phone)) {
                            errorarr.push("请输入电话号码！");
                        }
                        break;
                    case "birthday":
                        if (validator.empty(temp.birthday)) {
                            errorarr.push("请输入出生日期！");
                        }
                        break;
                    case "IDCard":
                        if (validator.empty(temp.IDCard)) {
                            errorarr.push("请输入身份证号码！");
                        }
                        break;
                    case "company":
                        if (validator.empty(temp.company)) {
                            errorarr.push("请输入单位名称！");
                        }
                        break;
                    case "position":
                        if (validator.empty(temp.position)) {
                            errorarr.push("请输入职位名称！");
                        }
                    break;
                    case "business":
                        if (validator.empty(temp.business)) {
                            errorarr.push("请输入行业名称！");
                        }
                    break;
                    case "school":
                        if (validator.empty(temp.school)) {
                            errorarr.push("请输入学校！");
                        }
                        break;
                    case "class":
                        if (validator.empty(temp.class)) {
                            errorarr.push("请输入班级！");
                        }
                        break;
                    case "discipline":
                        if (validator.empty(temp.discipline)) {
                            errorarr.push("请输入专业名称！");
                        }
                        break;
                }
            }
            if (errorarr.length > 0) {
                errorarr.pop();
                return false;
            }
            applyActivity.execute({id: self.id, temp: temp});
        }
        operationNav(e){
            self.currentIndex = $(e.target).attr("alt");
            self.update();
//                if(self.currentIndex == 3){
//                    previewImg($(".trave_img_wary"));
//                }

        };
        showFootterNav(e){
            $(e.target).toggleClass("footer_navs_but_hover");
            var classNmae = $(e.target).attr("class");
            if(classNmae.indexOf("footer_navs_but_hover") < 0){
                $(".footer_navs_wary").slideUp(100);
            }else{
                $(".footer_navs_wary").slideDown(100);
            }
            e.stopPropagation();
        };
        showattention_by_publish(){
            self.fromButtonClick = true;
            if(self.subscribe){
                riot.route("activity/new");
            }else{
                showattention_detail();
            }
        };
        showattention_detail(){
            var wintop = $(window).scrollTop();
            var winheight = $(window).height();
            var bodyheight = $("body").height();
            var apply_waryheight = $(".wechat-concern").height() - 100;
            var setHeight = winheight > bodyheight ? winheight : bodyheight;
            var settop = wintop + (winheight / 2) - (apply_waryheight / 2) - 100;
            $(".body_shadow_pull").show().css("height", setHeight + "px").css("z-index", "699");
            $(".wechat-concern").show().css("top", settop + "px");
        };
        function showattention_check(){
            if (!self.subscribe) {
                if (util.getCookie('showAttentionPrompt') == undefined) {
                    showattention_detail();
                    util.setCookie('showAttentionPrompt', 'true', 1);
                }
            }
        };
        var shareinfo_detail = function(e){
            var wintop = $(window).scrollTop();
            var winheight = $(window).height();
            var bodyheight = $("body").height();
            var setHeight = winheight > bodyheight ? winheight : bodyheight;
            $(".together_detail").show().css("top",wintop+"px").css("z-index","700");
            $(".body_shadow_pull").show().css("height",setHeight+"px").css("z-index","699");
        };
        self.shareinfo_detail = shareinfo_detail;
        hideBodyShadowAll_detail(e){
            $(".body_shadow_pull").hide();
            $(".wechat-concern").hide();
            $(".together_detail").hide();
            $(".sendmail").hide();
        };
        function mail_hideAll(){
            $(".body_shadow_pull").hide();
            $(".wechat-concern").hide();
            $(".together_detail").hide();
            $(".sendmail").hide();
        }
        openWxhref(e){
            $(".body_shadow_pull").hide();
            $(".wechat-concern").hide();
//                riot.route(util.getWxhref());
            util.setCookie('attentionUrl', "activity/_" + self.id + "", 1);
            window.location = self.wxhref;
        };
        preventEvent(e){
            e.stopPropagation();
        };
        likeActivity(e){
            if(!self.isActivityLike){
                likeActivity.execute(self.id);
            }else{ 
                util.tipssuccess(0, "已点赞！", 1);
            }
        }
        activityStar(e){
            starActivity.execute(self.id);
        };
        var signUp = function(){
            var wintop = $(window).scrollTop();
            var winheight = $(window).height();
            var bodyheight = $("body").height();
            var apply_waryheight = $(".apply_wary").height()-100;
            var apply_waryheightyuan = $(".apply_wary").height();
            var setHeight = winheight > bodyheight ? winheight : bodyheight;
            var settop = wintop+(winheight/2)-(apply_waryheight/2)-20;
            if(apply_waryheightyuan > winheight){
                settop = 10 ;
                $(window).scrollTop("0px");
            }
            $(".body_shadow").show().css("height",setHeight+"px");
            $(".body_shadow_pull").hide();
            $(".attention_wary").hide();
            $(".apply_wary").show().css("top",settop+"px");
        };
        sexSelect(e){
            $(".sex").removeClass("checked");
            $("#gender").val($(e.target).attr("value"));
            $(e.target).addClass("checked");
        };
        //关闭报名层及后面阴影层
        closeApplyLayer(e){
            hideAll();
            cleanDialog();
        };

        addRandomNote(e){
            util.setCookie('detailId', self.id, 30);
            riot.route('activity/add-randomnotes');
        }
        returnPage(e){
            riot.route(spa.history.length > 0 ? spa.history.pop() : 'activity/index');
        }
        //改变输入框高度oninput="{changeHeight}"
        changeHeight(e){
            var value = $(e.target)[0].value;
            var textWidth = $(e.target).width();
            var infoWidth = $(e.target)[0].value.length*14;
            var sum = Math.floor(infoWidth/textWidth);
            console.log("length: "+$(e.target)[0].value.length);
            console.log("textWidth: "+textWidth);
            console.log("infoWidth: "+infoWidth);
            console.log("infoWidth % textWidth: "+sum);
            if(sum >= 1){
                sum++;
                var inputHeight = sum*32;
                var footerHeight = sum*40;
                $(e.target).height(inputHeight);
                $(".footer").height(footerHeight);
                $(".footer_placeholder").height(footerHeight);
                console.log("inputHeight:"+inputHeight);
                console.log("footerHeight:"+footerHeight);
                console.log(sum);
            }
        }
        //导出电话
        showSendmail(e){
            loadContactFunc();
            var winheight = $(window).height();
            var bodyheight = $("body").height();
            var setHeight = winheight > bodyheight ? winheight : bodyheight;
            $(".body_shadow_pull").show().css("height", setHeight + "px").css("z-index", "699");
            $(".sendmail").show();
        }
        function setFunClick(s){
            var objName1 = "add"+s;
            var objName2 = "minus"+s;
            var objName3 = "num";
            var userName = "userName"+s;
            var identity = "identity"+s;
            $("#"+objName1).off("click");
            $("#"+objName1).click(function(){
                var sum = Number($("#"+objName3).attr("value"));
                $("#"+objName3).attr("value",++sum);
                console.info("+="+sum);
            });

            $("#"+objName2).off("click");
            $("#"+objName2).click(function(){
                var sum = Number($("#"+objName3).attr("value"));
                (sum>1) ?  $("#"+objName3).attr("value",--sum) : $("#"+objName3).attr("value",sum);
                console.info("-="+sum);
            });
        }

        var registerNav = function(){
            $("#detail_document").off("click").on("click",function(){
                $(".footer_navs_wary").slideUp();
                $(".footer_navs_but").removeClass("footer_navs_but_hover");
                resetFooterStyle();
            });
        };

        _resetFooterStyle(e){
            resetFooterStyle();
        }
        //设置群发链接
        _MassTextingURL(e){
            var url = "";
            var phoneObj = $(".activity-detail-applications .add_info_checked");
            var sendObj = $('.send');
            for(var i = 0,len=phoneObj.length;i<len;i++){
                var obj = phoneObj[i];
                url =  i==0 ? $(obj).attr('phone') : url+";"+$(obj).attr('phone');
            }
            if(url != ""){
                sendObj.attr('href',"sms:"+url);
                sendObj.attr('onclick',"");
            }else{
                sendObj.attr('href',"#");
                sendObj.attr('onclick',"javascript:var errorarr = []; errorarr.push('请选择要发送的队友');  util.tipssuccess(0, errorarr[errorarr.length-1], 1);return false;");
            }

        };
        //全选操作
        allSelect(e){
            if(self.selectbut){
                $('.add_info_checkbox_div1').addClass('add_info_checked');
                self.selectbut = false;
            }else{
                $('.add_info_checkbox_div1').removeClass('add_info_checked');
                self.selectbut = true;
            }
            self.update();
            this._MassTextingURL();
        }
        //取消操作
        cancelSend(e){
            var sendObj = $('.send');
            self.sms_send = 0;
            $('.add_info_checkbox_div1').removeClass('add_info_checked');
            self.selectbut = true;
            self.update();
            sendObj.attr('href',"#");
            sendObj.attr('onclick',"javascript:var errorarr = []; errorarr.push('请选择要发送的队友');  util.tipssuccess(0, errorarr[errorarr.length-1], 1);return false;");
        }
        //添加操作
        addSend(e){
            self.sms_send = 1;
            self.update();
        }
        //阻止事件冒泡
        interruptedBubbling(e){
            e.stopPropagation();
        }
        function resetFooterStyle(){
                $("#interflow_content").blur();
                $("#interflow_reply").blur();
                $('.communication-index').parent().removeClass('com_wary_background_color');
                self.consult = 0;
                self.update();
        }
        addComment(e){
            var cm = {
                "comment": "",
                "commenter": "",
                "commenterName":"",
                "replyTo": "",
                "replyToName":""
            };

            cm.comment = document.getElementById("interflow_content").value;
            cm.commenter = self.userId;

            var errorarr = [];

            var validator = util.validator();
            if (validator.empty(cm.comment)) {
                //errorHandler
                util.tipssuccess(1, errorarr[errorarr.length - 1], 1);
                return false;
            }

            commentActivity.execute({id: self.id, data: cm});
            hideAll();
            return true;

        }
        //修改状态(取消及发布调用此方法)
        function callBizAction(status){
            modifyStatusActivities.execute(self.id, status);
        }
        //修改状态(交流)
        replyComment(e){
            var cm = {
                "comment": "",
                "commenter": "",
                "commenterName": "",
                "replyTo": "",
                "replyToName": ""
            };

            cm.comment = document.getElementById("interflow_reply").value;

            var errorarr = [];
            var validator = util.validator();
            if (validator.empty(cm.comment)) {
                errorarr.push("请输入回复内容！");
            }
            if (errorarr.length > 0) {
                //errorHandler
                util.tipssuccess(1, errorarr[errorarr.length-1], 1);
                return;
            }

            var newContent = ':' + cm.comment;
            cm.comment = newContent;
            cm.commenter = self.userId;
            cm.replyTo = self.replyTo;
            cm.replyToName = self.replyToName;

            replyActivity.execute({id:self.id, data: cm});

            return true;
        };

        var newdate = self.newdate = new Date(__page.servertime);
        self.on('toabsolute',function(){
            self.btnbox.style.position = "absolute";
            self.btnbox.style.bottom = "0px";
        });

        self.on('tofixed',function(){
            self.btnbox.style.position = "fixed";
            self.btnbox.style.bottom = "0px";
        });

        //iphone兼容
        var u = navigator.userAgent;
        if(!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)) {
            brithdayClick(e){
                self.trigger('toabsolute');
            };
            birthdayBlur(e){
                self.trigger('tofixed');
            };
        };

        birthdayChange(e){
            var date = document.querySelector('#birthday');
            var dateText = document.querySelector('#birthdayTxt');
            if(date.value == "" && util.getBrowser().android ===false){
                date.value = newdate;
                dateText.value = util.dateFormat(newdate, 'yyyy/MM/dd');
                return false;
            }
            dateText.value = util.dateFormat(new Date(date.value), 'yyyy/MM/dd');
        };

        var showDesc = function(desc){
            $("#ac_detail").html(desc);
        }

        var loadContactFunc = function(){
            var invocation = loadContact.newInvocation(__page.user.id);
            invocation.onDone(function(data){
                if(data && data.contact){
                    self.contact = data.contact;
                    self.update();
                    if(document.querySelector('#birthday') && self.contact.birthday){
                        var date = document.querySelector('#birthday');
                        var dateText = document.querySelector('#birthdayTxt');
                        date.value = util.dateFormat(new Date(self.contact.birthday), 'yyyy-MM-dd');
                        dateText.value = util.dateFormat(new Date(self.contact.birthday), 'yyyy-MM-dd');
                    }
                }
            }).execute();
        }

    </script>
</activity-detail>
