<student-index>
    <div if="{!hidden}">
        <div class="usr_index_top">
            <img src="/web/images/def-head.png"/>
        </div>
        <div><label>昵称：</label>{__page.user.wx_nickname}</div>
        <div><label>姓名：</label>{user.name || '匿名'}</div>
        <div><label>手机：</label>{user.phone || '您没有输入手机号哦'}</div>
        <hr>
        <label>我的班级</label>
        <hr>
        <div each="{clazzes}" class="clazz-card" data-clazzid="{clazz}" onclick="{parent.enterClazz}">
            <span>{name}</span>
        </div>
    </div>
    <style scoped>
        .clazz-card{
            height: 40px;
            line-height: 40px;
            background: #e2dee4;
            margin-bottom: 10px;
        }
        .private-msg{
            height:48px;
            line-height: 48px;
            background: green;
            text-align: center;
        }
        .usr_index_top{
            text-align: center;height:120px;line-height: 120px;background:transparent url('/web/images/userinfobanner.png') no-repeat
        }

    </style>

    <script>
        var self = nest.presentable(this),
                ClazzFetchByStudentAction = domain.action("ClazzFetchByStudentAction");
        self.clazzes = [];
        var _open = function(data){
            ClazzFetchByStudentAction.execute();
        }.bind(self);
        var _refresh = function(){

        }.bind(self);
        this.on('open', function(options){
            _open(options);
        });
        this.on('mount',function(){
            ClazzFetchByStudentAction.onDone(OnClazzFetchByStudentAction);
        });

        this.on('refresh', function(){
            _refresh();
        });

        function OnClazzFetchByStudentAction(data){
            console.log(data)
            self.user = data.user;
            self.clazzes = data.clazzes;
            self.trigger('view-route-to');
        }
        enterClazz(e){
            riot.route('clazz/notifies?clazzId=' + e.currentTarget.getAttribute('data-clazzid'));
        }
    </script>
</student-index>