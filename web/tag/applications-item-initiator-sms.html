<applications-item-initiator-sms>
    <div class="applications-item" onclick="{checkboxSelect}">
        <div class="div1">
            <div>
                <div class="add_info_checkbox_div1" phone="{phone}" ></div>
                <img src={headImg} width="24" class="imgradius" /> {applicantName}
            </div>
            <div>
                <table class="">
                    <tr>
                        <td class=" td1">{_displayName}</td>
                        <td class=" td2">{num}人</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <script>
        var self = this;
        var _env = function() {
            if (__app.settings.env.NODE_ENV=="production"){
                return "public";
            }
            else{
                return "web";
            }
        }

        self.env = _env();
        console.log("env=" + self.env);

        var parent = this.opts.tag.parent;
        self.tag = this.opts.tag;
        self.initiator = parent.initiator;
        self.userId = parent.userId;
        self.smsImg = "/" + self.env + "/images/sms.png";
        self.telImg = "/" + self.env + "/images/tel.png";
        self.appFields = __page.appFields;
        self.appFieldNameArr = Object.keys(self.appFields);
        self.moreOption = false;

        var indexArr = [];
        var ifExist = false;
        for(var i = 0, len = self.appFieldNameArr.length; i < len; i++){
            if(self.appFieldNameArr[i] == "displayName" || self.appFieldNameArr[i] == "phone"){
                indexArr.push(i);
            }else{
                if(self.tag[self.appFieldNameArr[i]] && !ifExist){
                    self.moreOption = true;
                    ifExist = true;
                }
            }
        }
        for(var i = 0, len = indexArr.length; i < len; i++){
            self.appFieldNameArr.splice(indexArr[i],1);
            indexArr[i + 1] = indexArr[i + 1] - 1;
        }

        //judge if it is an initiator
        var _isNitiator = function(){
            var b = false;
            if (self.initiator==null){
                b = false;
            }
            else if (self.userId==null){
                b = false;
            }else if (self.initiator==self.userId){
                b = true;
            }else {
                b = false;
            }

            return b;
        }

        self.isNitiator = _isNitiator();

        //head Image to display from wechat
        var _headImg = function(){
            if (self.tag.applicant==null){
                var p = "/" + self.env + "/images/head.png";
                console.log("headImg=" + p);
                return p;
            }
            else if (self.tag.applicant.headImgUrl==null){
                var p = "/" + self.env + "/images/head.png";
                console.log("headImg=" + p);
                return p;
            }
            else{
                return self.tag.applicant.headImgUrl;
            }
        }

        self.headImg = _headImg();

        //name+phone string user filled when apply
        var __displayName = function(){

            if (self.isNitiator==true) {
                if (self.tag.displayName!=null){
                    return (self.tag.displayName + '/' + self.tag.phone);
                }
                else{
                    return self.tag.phone;
                }


            }else{
                return "";
            }

            //(dName==true)?((displayName!=null)?(displayName+'/'+phone):phone):phone

        }

        self._displayName = __displayName();

        //wechat nickname
        var _applicantName = function(){
            if (self.tag.applicant==null){
                return "匿名";
            }
            else{
                if (self.tag.applicant.displayName==null){
                    return "匿名";
                }
                else{
                    return self.tag.applicant.displayName;
                }
            }

            //applicant==null?'匿名':((applicant.displayName==null)?'匿名':applicant.displayName)
        }
        self.applicantName = _applicantName();

        checkboxSelect(e){
            $(e.currentTarget).find('.add_info_checkbox_div1').toggleClass('add_info_checked');
            parent._MassTextingURL();
        }
    </script>
</applications-item-initiator-sms>

