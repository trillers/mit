<clazz-notify>
        <span onclick="{toggleGetReplyInfo}">{content}</span>
        <div if="{showOrNot}">
            <input value="回复消息" type="button"/><br/>
            <input name="payLoad" type="text"/><input data-msgfrom="{from.user}" data-msgid="{_id}" onclick="{replyNotify}" value="确认发送" type="button"/>
            <ul>
                <li each="{replies}" data-msgfrom="{from.user}" onclick="{parent.selectSendTo}">
                    <img src="{from.headUrl}"/><span>{from.name || '匿名'} {to}: {content}</span>
                </li>
            </ul>
        </div>
    <style scoped>
        span:first-child{
            background: #f5f5f5;
            display: block;
        }
    </style>
    <script>
        var self = nest.presentable(this),
            MsgInClazzAddAction = domain.action('MsgInClazzAddAction'),
                MsgReplyLoadAction = domain.action('MsgReplyLoadAction');
        self.msgId = this.opts.msgid;
        self.msgCurrFromId = "";
        self.replies = [];
        self.showOrNot = false;
        toggleGetReplyInfo(e){
            if (self.showOrNot === true) {
                self.showOrNot = false;
                return false;
            }
            self.msgCurrFromId = e.currentTarget.getAttribute('data-msgfrom');
            MsgReplyLoadActionInvocation();
        }
        selectSendTo(e){
            self.payLoad.value = e.currentTarget.getAttribute('data-msgfrom');
        }
        function MsgReplyLoadActionInvocation(data){
            var invocation = MsgReplyLoadAction.newInvocation({channel: self.msgId, msgFrom: self.msgCurrFromId});
            invocation.onDone(function(docs){
                self.replies = docs;
                self.showOrNot = true;
                self.update();
            }).execute();
        }
        replyNotify(e){
            if(self.payLoad.value.trim() === ''){
                return;
            }
            var invocation = MsgInClazzAddAction.newInvocation({
                channel: e.currentTarget.getAttribute('data-msgid'),
                content: self.payLoad.value
            });
            invocation.onDone(function(doc){
                self.payLoad.value = "";
                self.replies.unshift(doc);
                self.update();
            }).execute();
            e.stopPropagation();
        }
    </script>
</clazz-notify>