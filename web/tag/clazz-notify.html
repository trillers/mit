<clazz-notify>
    <span onclick="{toggleGetReplyInfo}">{content}</span>
    <div if="{showOrNot}">
        <input value="回复消息" type="button"/><br/>
        <input name="payLoad" type="text"/><input data-msgid="{_id}" onclick="{replyNotify}" value="确认发送" type="button"/>
        <ul>
            <li each="{replies}"><span>{from}: {content}</span>

            </li>
        </ul>
    </div>
    <script>
        var self = nest.presentable(this),
            MsgInClazzAddAction = domain.action('MsgInClazzAddAction'),
                MsgReplyLoadAction = domain.action('MsgReplyLoadAction');
        self.showOrNot = false;
        toggleGetReplyInfo(e){
            if (self.showOrNot === true) {
                self.showOrNot = false;
                return false;
            }
        }
        function MsgReplyLoadActionInvocation(data){
            var invocation = MsgReplyLoadAction.newInvocation(data.clazzId);
            invocation.onDone(function(docs){
                self.replies = docs;
                self.showOrNot = true;
                self.update();
            }).execute();
        }
        replyNotify(e){
            var invocation = MsgInClazzAddAction.newInvocation({
                channel: e.currentTarget.getAttribute('data-msgid'),
                content: self.payLoad.value
            });
            invocation.onDone(function(doc){
                self.msgs.unshift(data);
                self.update();
            }).execute();
            e.stopPropagation();
        }
    </script>
</clazz-notify>