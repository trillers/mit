<teacher-index>
    <div if="{!hidden}">
        <ul class="clazzAccordion" onclick="{showSubMenu}">
            <li each="{clazzes}" data-id="{_id}" onclick="{parent.getStudents}">
                <span>{name}</span>
                <ul>
                    <li each="{students}">张三<input type="button" value="send" class="{show: parent.currSendTo === name}"/></li>
                </ul>
            </li>
        </ul>
        <footer-bar></footer-bar>
    </div>
    <style scoped>
        .clazzAccordion >li{
            border-bottom: 1px solid rgb(72, 92, 174);
        }
        .clazzAccordion >li ul{
            max-height:0px;
            transition:max-height 0.3s ease;
            -moz-transition:max-height 0.3s ease; /* Firefox 4 */
            -webkit-transition:max-height 0.3s ease; /* Safari and Chrome */
            -o-transition:max-height 0.3s ease; /* Opera */
        }
        .clazzAccordion li >span{
            height:32px;
            line-height:32px;
            display: block;
            padding-left:10px;
            background: rgb(110, 136, 240);
        }
        .clazzAccordion ul{
            overflow: hidden;
        }
        .clazzAccordion ul>li{
            padding-left:10px;
            height:32px;
            line-height: 32px;
        }
        .clazzAccordion ul>li>input{
            display: none;
        }
        .clazzAccordion ul>li:nth-child(odd){
            background: #ECECEC;
        }
        .clazzAccordion ul>li:nth-child(even){
            background: #EFEFEF;
        }
        .hidden{
            max-height:500px !important;
        }
        .show{
            display:block !important;
        }
    </style>

    <script>
        var self = nest.presentable(this),
            ClazzFetchByTeacherAction = domain.action('ClazzFetchByTeacherAction');
            ClazzLoadStudentsAction = domain.action('ClazzLoadStudentsAction');

        self.clazzes = [];
        self.currSendTo = '';
        self.message = {
            sendFrom: '',
            sendTo: self.currSendTo,
            content:''
        }

        showSubMenu(e){
            var _handlers = {
                'SPAN': function(target){
                    console.log($(target).parent().index())
                    return $(target).siblings().toggleClass('hidden');
                },
                'LI': function(target){
                    //popup the msg btn
                    self.currSendTo = '121';
                },
                'INPUT': function(target){
                    //sendTo
                    alert(1)

                }
            };
            _handlers[e.target.tagName](e.target);
        }

        getStudents(e){
            for (var i = 0, len = self['clazzes'].length; i < len; i++) {
                if (self.clazzes[i]._id = e.target.getAttribute('data-id')) {
                    ClazzLoadStudentsAction.execute(self.clazzes[i]._id);
                }
            }
        }

        var _open = function(id){
        }.bind(self);
        var _refresh = function(){

        }.bind(self);
        this.on('open', function(options){
            ClazzFetchByTeacherAction.execute();
            _open(options);
        });
        this.on('mount',function(){
            ClazzFetchByTeacherAction.onDone(OnClazzFetchByTeacherAction);
            ClazzLoadStudentsAction.onDone(OnClazzLoadStudentsAction);
            console.info('tag activities is mounted');
        });
        function OnClazzFetchByTeacherAction(data){
            console.log(data)
            self.clazzes = data && data.clazzes || {};
            self.update();
            self.trigger('view-route-to');
        };
        function OnClazzLoadStudentsAction(data){
            self.clazzes.students = data.students;
            self.update();
        };
        this.on('refresh', function(){
            console.info('tag activity is refreshing');
            _refresh();
        });
    </script>
</teacher-index>
