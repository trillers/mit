<activity-createsuccess>
    <div if="{!hidden}" id="createsuccess_document" class="activity-createsuccess">
        <div><img src="/{env=='production'?'public':'web'}/images/c_01.png" /></div>
        <div><img src="/{env=='production'?'public':'web'}/images/c_02.png" /></div>
        <div class="t-c">
            提示
        </div>
        <div class="t-c" >
            已发布的活动可以在“我的活动”中查看和管理。
        </div>
        <div class="footer_placeholder clear"></div>
        <div class="footer">
            <div onclick="{homepage}"></div>
            <div class="button but2" style="width:36%;" onclick="{jumpActivitypPage}">查看活动</div>
            <div class="button but2" style="width:36%;" onclick="{jumpNewPage}">发布活动</div>
        </div>
    </div>

    <style scoped>
        
    </style>

    <script>
        var self = nest.presentable(this);
        self.env = __app.settings.env.NODE_ENV;
        var replyToName = "1";
        var model = nest.modelable({}, {
            url: __app.settings.api.url + "/pa/"
        });
        model._id = this._id = this.opts._id;
        model.on('fetch', function(json, options){
            console.info('activity is fetched');
            self.item = json;
            self.picshow = util.calcImageUrl(self.item);
            self.update();
            setWeiXinInfo();
        });
        showFootterNav(e){
            $(e.target).toggleClass("footer_navs_but_hover");
            var classNmae = $(e.target).attr("class");
            if(classNmae.indexOf("footer_navs_but_hover") < 0){
                $(".footer_navs_wary").slideUp(200);
            }else{
                $(".footer_navs_wary").slideDown(200);
            }
            e.stopPropagation();
        }
        var _open = function(id){
            this.trigger('ready', false);
            this.update();
            this.trigger('ready', true);
            this.trigger('view-route-to');
            console.log(id);
            console.log(this._id);
            this._id = id || this._id;
            model.set('_id', this._id);
            model.fetch({action: 'open'});
        }.bind(self);
        var _refresh = function(){
            this.trigger('ready', false);
            model.fetch(this._id, {action: 'refresh'});
        }.bind(self);
        this.on('open', function(options){
            console.log(options);
            console.info('tag activities is opening');
            _open(options);
            $(window).scrollTop("0px");
        });
        this.on('mount',function(){
            console.info('tag activities is mounted');
        });
        this.on('refresh', function(){
            console.info('tag activity is refreshing');
            _refresh();
        });
        homepage(e){
            riot.route('activity/index');
        }
        jumpNewPage(e){
            riot.route('activity/new');
        }
        jumpActivitypPage(e){
            riot.route('activity/_'+model._id);
        }
        var setWeiXinInfo = function(){ 
            //var imgurl = self.picshow.indexOf("http") >-1 ? self.picshow:__page.holder().getBaseUrl()+self.picshow;
            //var imgurl = self.item.images[0] ? "http://file.api.weixin.qq.com/cgi-bin/media/get?access_token="+__page.at+"&media_id="+self.item.images[0].mediaId:__page.holder().getBaseUrl()+self.picshow;
            var imgurl = util.sharepic(self.item);
            $("#createsuccess_document").off("click").on("click",function(){
                $(".footer_navs_wary").slideUp();
                $(".footer_navs_but").removeClass("footer_navs_but_hover");
            });
            wx.ready(function(){
                //分享给朋友
                var shareMsg = {
                    title: self.item.name, // 分享标题
                    desc: self.item.desc, // 分享描述
                    link: __page.holder().getBaseUrl()+"/index#activity/_"+model._id, // 分享链接
                    imgUrl: imgurl // 分享图标
                };
                wx.onMenuShareAppMessage(shareMsg);
                //分享朋友圈
                var shareMsgTest = {
                    title: self.item.name, // 分享标题
                    desc: self.item.desc,
                    link:  __page.holder().getBaseUrl()+"/index#activity/_"+model._id, // 分享链接
                    //imgUrl:imgurl
                    imgUrl: imgurl, // 分享图标
                    success:function(){
                        _czc.push(['_trackEvent', util.getDc().PA.NAME + '(' + util.getDc().PA.ACTION.VIEW + ')', self.item.name || '', util.convertToValue(self.item.tags.type).join(',') || '']);
                    }
                };
                wx.onMenuShareTimeline(shareMsgTest);
            });
        }
        $(window).scrollTop("0px");
    </script>
</activity-createsuccess>