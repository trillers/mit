var init=function(){var riot = require('seedriot');riot.tag("clazz-add",'<div if="{!hidden}"> <input type="text" name="clazzname"> <input type="button" value="添加班级" onclick="{addClazz}"> </div>',function(){function t(){riot.route("teacher/index")}var n=nest.presentable(this),i=domain.action("ClazzAddAction");this.addClazz=function(){var t={name:n.clazzname.value};i.execute(t)}.bind(this),this.on("mount",function(){i.onDone(t)}),this.on("open",function(){this.trigger("view-route-to")})});
riot.tag("clazz-card",'<span onclick="{toggleGetClazzInfo}">{name}<input type="button" onclick="{locateToSendPage}" if="{showOrNot}" value="群发消息"></span> <div if="{showOrNot}"> <div class="qrSection"><b>班级二维码:</b> <img riot-src="{getQrChannelImg()}"></div> <div class="addStuSection"> <b>学生姓名:</b> <input name="stuName" type="text"> <b>学生电话:</b> <input name="stuPhone" type="text"> <input type="button" value="添加学生" onclick="{addStudent}"> </div> <ul> <li each="{clazz.students}" onclick="{parent.toggleMsgBtn}"><img riot-src="{headUrl}">姓名: {name} 手机: {phone}</li> </ul> </div>',function(){function t(t){var a=e.newInvocation(t.clazzId);a.onDone(function(t){n.clazz={students:t.students,qrChannel:t.qrChannel},n.showOrNot=!0,n.update()}).execute()}var n=nest.presentable(this),e=domain.action("ClazzLoadAction"),a=domain.action("ClazzAddStudentAction");n.showOrNot=!1,n.msgBtnShow=!1,n.clazz={students:[],qrChannel:{}},n.clazzId=this.opts["data-id"],n.clazzBriefId=this.opts["data-clazzbriefid"],n.getQrChannelImg=function(){return this.clazz&&this.clazz.qrChannel&&this.clazz.qrChannel.ticket&&util.CONSTANT.QRURL+this.clazz.qrChannel.ticket||""}.bind(n),this.toggleGetClazzInfo=function(e){return n.showOrNot===!0?(n.showOrNot=!1,!1):(t({clazzId:e.target.parentNode.getAttribute("data-id")}),void 0)}.bind(this),this.locateToSendPage=function(t){riot.route("clazz/notifies?clazzId="+n.clazzId),t.stopPropagation()}.bind(this),this.addStudent=function(t){var e=a.newInvocation({clazzId:t.currentTarget.parentNode.parentNode.parentNode.getAttribute("data-id"),name:n.stuName.value,phone:n.stuPhone.value,clazzBriefId:n.clazzBriefId});e.onDone(function(t){n.clazz={students:t.students,qrChannel:t.qrChannel},n.update()}).execute(),t.stopPropagation()}.bind(this),this.on("mount",function(){})});
riot.tag("clazz-chat",'<div class="chat_card" if="{!hidden}"> <div each="{msgs}"> <div><span>{content}</span> <ul> <li each="{replies}"><span>{from}: {content}</span> <ul> <li each="{replies}">{from}: {content}</li> </ul> </li> </ul> </div> </div> <input type="text" value="" name="content"><input onclick="{publishMsg}" type="button" value="确定发送">','clazz-chat .chat_card, [riot-tag="clazz-chat"] .chat_card{ background: #f3f3f3; } clazz-chat .chat_card div, [riot-tag="clazz-chat"] .chat_card div{ background: white; margin-bottom: 10px; height: 60px; }',function(){function n(n){a.msgs=n,a.trigger("view-route-to")}function t(n){a.msgs.unshift(n),a.update()}var a=nest.presentable(this),c=domain.action("MsgInClazzLoadAction"),i=domain.action("MsgInClazzAddAction");a.msgs=[],a.clazzId="",this.publishMsg=function(){i.execute({channel:a.clazzId,content:a.content.value})}.bind(this);var e=function(n){a.clazzId=n.clazzId,c.execute({channel:n.clazzId})}.bind(a),o=function(){}.bind(a);this.on("open",function(n){e(n)}),this.on("mount",function(){c.onDone(n),i.onDone(t)}),this.on("refresh",function(){o()})});
riot.tag("clazz-notifies",'<div class="chat_card" if="{!hidden}"> <clazz-notify class="chat_notify" each="{msgs}" msgid="{_id}"></clazz-notify> </div>','clazz-notifies .chat_card, [riot-tag="clazz-notifies"] .chat_card{ background: #ECECEC; } clazz-notifies .chat_card .chat_notify, [riot-tag="clazz-notifies"] .chat_card .chat_notify{ display: block; background: white; margin-bottom: 10px; border-bottom: 1px solid #E9E9E9; min-height: 60px; line-height: 60px; }',function(){function t(t){i.msgs=t,i.trigger("view-route-to")}var i=nest.presentable(this),n=domain.action("MsgInClazzLoadAction");i.msgs=[],i.clazzId="";var a=function(t){i.clazzId=t.clazzId,n.execute({channel:t.clazzId})}.bind(i),o=function(){}.bind(i);this.on("open",function(t){a(t)}),this.on("mount",function(){n.onDone(t)}),this.on("refresh",function(){o()})});
riot.tag("clazz-notify-reply",'<div onclick="{selectSendTo}"> <img riot-src="{from.headUrl}"><span>{from.name || \'匿名\'} {to}: {content}</span> </div>',function(){var t=nest.presentable(this);console.log(t.opts.data-msgfrom),this.selectSendTo=function(){}.bind(this)});
riot.tag("clazz-notify",'<span onclick="{toggleGetReplyInfo}">{content}</span> <div if="{showOrNot}"> <input value="回复消息" type="button"><br> <div id="commenter"><input name="payLoad" type="text"></div><input data-msgfrom="{from.user}" data-msgid="{_id}" onclick="{replyNotify}" value="确认发送" type="button"> <ul> <li each="{replies}" data-msgfrom="{from.user}" data-fromname="{from.name}" onclick="{from.user != __page.user._id ? parent.selectSendTo : \'\'}"> <img riot-src="{from.headUrl}"><span>{from.name || \'匿名\'} {to && \'@\' + to.name}: {content}</span> </li> </ul> </div>','clazz-notify span:first-child, [riot-tag="clazz-notify"] span:first-child{ background: #f5f5f5; display: block; } clazz-notify .reply_to, [riot-tag="clazz-notify"] .reply_to{ display: inline-block; height:32px; background: #0055aa; color:white; line-height: 32px; padding:0px 10px; }',function(){function t(){var t=o.newInvocation({channel:e.msgId,msgFrom:e.msgCurrFromId});t.onDone(function(t){e.replies=t,e.update()}).execute()}var e=nest.presentable(this),n=domain.action("MsgInClazzAddAction"),o=domain.action("MsgReplyLoadAction");e.msgId=this.opts.msgid,e.msgCurrFromId="",e.replies=[],e.showOrNot=!1,e.triggred=!1;var i=widget.commenter,r=new i;util.extend(r,riot.observable({})),r.on("toUserRemove",function(){e.sendTo=null}),this.on("initCommenter",function(){return this.triggered?!1:(r.init({container:document.getElementById("commenter")}),this.triggered=!0,void 0)}),this.toggleGetReplyInfo=function(n){return e.showOrNot===!0?(e.showOrNot=!1,!1):(e.showOrNot=!0,e.update(),e.msgCurrFromId=n.currentTarget.getAttribute("data-msgfrom"),t(),this.trigger("initCommenter"),void 0)}.bind(this),this.selectSendTo=function(t){e.sendTo=t.currentTarget.getAttribute("data-msgfrom"),r.input(t.currentTarget.getAttribute("data-fromname"))}.bind(this),this.replyNotify=function(t){if(""!==e.payLoad.value.trim()){var o=n.newInvocation({to:e.sendTo,channel:t.currentTarget.getAttribute("data-msgid"),content:e.payLoad.value});o.onDone(function(t){e.payLoad.value="",e.replies.unshift(t),e.update()}).execute(),t.stopPropagation()}}.bind(this)});
riot.tag("footer-bar",'<div> <input type="button" value="添加班级" onclick="{addClazz}"> <input type="button" value="群发消息" onclick="{sendMsgs}"> </div>',function(){nest.presentable(this);this.addClazz=function(){riot.route("clazz/add")}.bind(this),this.sendMsgs=function(){}.bind(this)});
riot.tag("student-index",'<div if="{!hidden}"> <div>{__page.user.nicName}</div> <div>{__page.user.name}</div> <div>{__page.user.name}</div> <div each="{clazzes}" class="clazz-card" data-clazzid="{clazz}" onclick="{parent.enterClazz}"> <span>{_id} {name}</span> </div> </div>','student-index .clazz-card, [riot-tag="student-index"] .clazz-card{ height: 40px; line-height: 40px; background: red; margin-bottom: 10px; }',function(){function n(n){console.log(n),e.clazzes=n.clazzes,e.trigger("view-route-to")}var e=nest.presentable(this),t=domain.action("ClazzFetchByStudentAction");e.clazzes=[];var i=function(){t.execute()}.bind(e),a=function(){}.bind(e);this.on("open",function(n){i(n)}),this.on("mount",function(){t.onDone(n)}),this.on("refresh",function(){a()}),this.enterClazz=function(n){riot.route("clazz/notifies?clazzId="+n.currentTarget.getAttribute("data-clazzid"))}.bind(this)});
riot.tag("student-signup",'<div if="{!hidden}"> <input type="text" name="studentName"> <input type="text" name="studentPhone"> <input type="button" value="注册" onclick="{signUp}"> </div>',function(){function n(){riot.route("student/index")}var t=nest.presentable(this),i=domain.action("StudentSignUpAction");this.signUp=function(){i.execute({name:t.studentName.value,phone:t.studentPhone.value})}.bind(this);var e=function(){this.trigger("view-route-to")}.bind(t),o=function(){}.bind(t);this.on("open",function(n){console.info("tag activities is opening"),e(n)}),this.on("mount",function(){i.onDone(n),console.info("tag activities is mounted")}),this.on("refresh",function(){console.info("tag activity is refreshing"),o()})});
riot.tag("teacher-index",'<div if="{!hidden}"> <div class="clazzAccordion"> <clazz-card class="clazzCard" each="{clazzes}" data-clazzbriefid="{_id}" data-id="{clazz}"></clazz-card> </div> <footer-bar></footer-bar> </div>','teacher-index .clazzAccordion >.clazzCard, [riot-tag="teacher-index"] .clazzAccordion >.clazzCard{ border-bottom: 1px solid rgb(72, 92, 174); } teacher-index .clazzAccordion .clazzCard >span, [riot-tag="teacher-index"] .clazzAccordion .clazzCard >span{ height:32px; line-height:32px; display: block; padding-left:10px; background: rgb(110, 136, 240); } teacher-index .clazzAccordion .clazzCard img, [riot-tag="teacher-index"] .clazzAccordion .clazzCard img{ display: inline-block; height:48px; width:48px; } teacher-index .clazzAccordion .clazzCard >div>ul>li>img, [riot-tag="teacher-index"] .clazzAccordion .clazzCard >div>ul>li>img{ width:40px; height:40px; border-radius: 50em; margin-right: 10px; } teacher-index .clazzAccordion ul, [riot-tag="teacher-index"] .clazzAccordion ul{ overflow: hidden; } teacher-index .clazzAccordion ul>li, [riot-tag="teacher-index"] .clazzAccordion ul>li{ padding-left:10px; height:48px; line-height: 48px; } teacher-index .clazzAccordion ul>li>input, [riot-tag="teacher-index"] .clazzAccordion ul>li>input{ display: none; } teacher-index .clazzAccordion ul>li:nth-child(odd), [riot-tag="teacher-index"] .clazzAccordion ul>li:nth-child(odd){ background: #ECECEC; } teacher-index .clazzAccordion ul>li:nth-child(even), [riot-tag="teacher-index"] .clazzAccordion ul>li:nth-child(even){ background: #EFEFEF; } teacher-index .show, [riot-tag="teacher-index"] .show{ display:block !important; } teacher-index .clazzAccordion .qrSection, [riot-tag="teacher-index"] .clazzAccordion .qrSection{ height:64px; line-height: 64px; }',function(){function c(c){i.clazzes=c&&c.clazzes||{},i.update(),i.trigger("view-route-to")}var i=nest.presentable(this),e=domain.action("ClazzFetchByTeacherAction");i.clazzes=[],i.currSendTo="",i.message={sendFrom:"",sendTo:i.currSendTo,content:""};var a=function(){}.bind(i),n=function(){}.bind(i);this.on("open",function(c){e.execute(),a(c)}),this.on("mount",function(){e.onDone(c)}),this.on("refresh",function(){n()})});
riot.tag("teacher-signup",'<div if="{!hidden}"> <label>教师姓名:</label><input type="text" name="teacherName"> <br> <label>手机号码:</label><input type="text" name="teacherPhone"> <br> <input type="button" value="注册" onclick="{signUp}"> </div>',function(){function e(){riot.route("teacher/index")}var n=nest.presentable(this),t=domain.action("TeacherSignUpAction");this.signUp=function(){t.execute({name:n.teacherName.value,phone:n.teacherPhone.value})}.bind(this);var i=function(){this.trigger("view-route-to")}.bind(n),o=function(){}.bind(n);this.on("open",function(e){console.info("tag activities is opening"),i(e)}),this.on("mount",function(){t.onDone(e),console.info("tag activities is mounted")}),this.on("refresh",function(){console.info("tag activity is refreshing"),o()})});alert('loaded complete')};module.exports = init;